<div class="grid-container">


    <div class="omdb">
        <h1>Search for a Movie!</h1>
        <form id="searchmovie" class="button-size">
            <textarea type="text" name="movie"></textarea>
            <button type="submit">Search for Movie!</button>



        </form>
    </div>


    <div class="tosee">
        <h1>Movies to See!</h1>

        <ul>
            {{#each to_see_list}} {{#unless watched}}
            <li>
                <p>
                    {{id}}. {{name}}

                    <button data-nameid="{{id}}" class="removename">Remove Movie</button>
                    <button data-watchid="{{id}}" class="watchmovie">Watched This Movie!</button>
                </p>
            </li>
            {{/unless}} {{/each}}
        </ul>
    </div>

    <div class="seen">
        <h1>Movies You have Watched Already.</h1>
        <ul>
            {{#each to_see_list}} {{#if watched}}
            <li>
                <p>
                    {{id}}. {{name}}

                    <button data-nameid="{{id}}" class="removename">Remove Movie</button>
                    <button data-watchid="{{id}}" class="watchmovie">Watched This Movie!</button>
                </p>
            </li>
            {{/if}} {{/each}}
        </ul>
    </div>


    <div class="addmovie">
        <h2>Add a Move You Would Like to See!</h2>
        <form id="addmovie" class="button-size">
            <textarea type="text" name="name"></textarea>
            <button type="submit">Add Movie!</button>
        </form>
    </div>

    <div class="updatemovie">
        <h2>Update a Movie</h2>
        <form id="updatemovie" class="button-size">
            <select name="id">
                {{#each to_see_list}}
                <option value="{{id}}">{{name}}</option>
                {{/each}}
            </select>
            <textarea type="text" name="name" placeholder="Movie Name"></textarea>
            <button type="submit">Update Movie!</button>
        </form>
    </div>

</div>

<script type="text/javascript">

    $("#searchmovie").on("submit", function (event) {
        event.preventDefault();

        var searchMovie = $("#searchmovie [name=movie]").val().trim();


        $.ajax("/search/" + searchMovie, {
            type: "GET"
        }).then(
            function (result) {
                console.log("Searching for: " + searchMovie);
                console.log(result);

                var movieinfo = $("<div>");
                movieinfo.addClass("movieinfo");

                movieinfo.append("<h1>Title: " + result.Title + "</h1>");
                movieinfo.append("<p>Date of Release: " + result.Released + "</p>");
                movieinfo.append("<p>Rated: " + result.Rated + "</p>");
                movieinfo.append("<p>Runtime: " + result.Runtime + "</p>");
                movieinfo.append("<p>Directed by: " + result.Director + "</p>");
                movieinfo.append("<p>Actors: " + result.Actors + "</p>");
                movieinfo.append("<p>Plot: " + result.Plot + "</p>");     


                $(".omdb").append(movieinfo);
            }
        );
    });

    $(".removename").on("click", function (event) {
        var id = $(this).data("nameid");

        $.ajax("/tosee/" + id, {
            type: "DELETE"
        }).then(
            function () {
                console.log("deleted id ", id);

                location.reload();
            }
        );
    });

    $(".watchmovie").on("click", function (event) {
        event.preventDefault();

        var id = $(this).data("watchid");

        var watchedMovie = {
            watched: true
        };

        $.ajax("/watched/" + id, {
            type: "PUT",
            data: watchedMovie
        }).then(
            function () {
                console.log("you watched this movie id ".id);

                location.reload();
            }
        );
    });

    $("#addmovie").on("submit", function (event) {
        event.preventDefault();

        var newMovie = {
            name: $("#addmovie [name=name]").val().trim()
        };

        $.ajax("/tosee", {
            type: "POST",
            data: newMovie
        }).then(
            function () {
                console.log("added new movie.");

                location.reload();
            }
        );
    });

    $("#updatemovie").on("submit", function (event) {
        event.preventDefault();

        var id = $("[name=id").val().trim();


        var updatedMovie = {
            name: $("#updatemovie [name=name").val().trim()
        };

        $.ajax("/tosee/" + id, {
            type: "PUT",
            data: updatedMovie
        }).then(
            function () {


                location.reload();
            }
        );
    });
</script>